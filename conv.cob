IDENTIFICATION DIVISION.
PROGRAM-ID. conv.

DATA DIVISION.
WORKING-STORAGE SECTION.
77  I            PICTURE S99 USAGE IS COMPUTATIONAL.
77  PREV-DECIMAL PICTURE S9(4) USAGE IS COMPUTATIONAL.
77  CURR-DECIMAL PICTURE S9(4) USAGE IS COMPUTATIONAL.

LINKAGE SECTION.
77  ARRAY-SIZE   PICTURE S99 USAGE IS COMPUTATIONAL.
77  ERR          PICTURE S9 USAGE IS COMPUTATIONAL-3.
77  RESULT       PICTURE S9(8) USAGE IS COMPUTATIONAL.
01  ARRAY-AREA.
    02 S         PICTURE X(1) OCCURS 30 TIMES.

PROCEDURE DIVISION USING ARRAY-AREA, ARRAY-SIZE, ERR, RESULT.
MOVE ZERO TO RESULT.
MOVE 1001 TO PREV-DECIMAL.
MOVE 1 TO ERR.
PERFORM COMPUTE-LOOP
    VARYING I FROM 1 BY 1
    UNTIL I IS GREATER THAN ARRAY-SIZE OR ERR = 2.
GOBACK.

COMPUTE-LOOP.
    EVALUATE S(I)
        WHEN 'I' MOVE 1 TO CURR-DECIMAL
        WHEN 'V' MOVE 5 TO CURR-DECIMAL
        WHEN 'X' MOVE 10 TO CURR-DECIMAL
        WHEN 'L' MOVE 50 TO CURR-DECIMAL
        WHEN 'C' MOVE 100 TO CURR-DECIMAL
        WHEN 'D' MOVE 500 TO CURR-DECIMAL
        WHEN 'M' MOVE 1000 TO CURR-DECIMAL
        WHEN OTHER MOVE 2 TO ERR.

    ADD CURR-DECIMAL TO RESULT.
    IF CURR-DECIMAL IS GREATER THAN PREV-DECIMAL
        COMPUTE RESULT = RESULT - 2 * PREV-DECIMAL
    END-IF.
    MOVE CURR-DECIMAL TO PREV-DECIMAL.
